(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{29:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(19),o=n.n(s),r=n(8),i=(n(29),n(24)),u=n(2),l=n(3),p=n(0);var d=function(e){return Object(p.jsxs)("header",{className:"header",children:[Object(p.jsx)("div",{className:"header__logo"}),e.children]})},h=c.a.createContext();var j=function(e){var t=c.a.useContext(h),n=e.card.owner===t.userId,a=e.card.likes.some((function(e){return e===t.userId}));return Object(p.jsxs)("li",{className:"element",children:[Object(p.jsx)("img",{className:"element__image",src:e.card.link,alt:e.card.name,onClick:function(){e.onCardClick(e.card)}}),Object(p.jsx)("button",{className:"element__remove-button",type:"button",style:n?{visibility:"visible"}:{visibility:"hidden"},onClick:function(){return e.onCardDelete(e.card)}}),Object(p.jsxs)("div",{className:"element__heading",children:[Object(p.jsx)("p",{className:"element__title",children:e.card.name}),Object(p.jsxs)("div",{className:"element__container",children:[Object(p.jsx)("button",{className:a?"element__heart element__heart_active":"element__heart element__heart_disabled",type:"button",onClick:function(){e.onCardLike(e.card)}}),Object(p.jsx)("p",{className:"element__counter",children:e.card.likes.length})]})]})]})};var m=function(e){var t=Object(a.useContext)(h),n=e.cards;return Object(p.jsxs)("main",{children:[Object(p.jsxs)("section",{className:"profile",children:[Object(p.jsxs)("div",{className:"profile__avatar-container",children:[Object(p.jsx)("img",{src:t.userAvatar,className:"profile__avatar",alt:"\u0410\u0432\u0430\u0442\u0430\u0440 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",onClick:e.onEditAvatar}),Object(p.jsx)("button",{className:"profile__edit-avatar",type:"button",onClick:e.onEditAvatar})]}),Object(p.jsxs)("div",{className:"profile__info",children:[Object(p.jsx)("h1",{className:"profile__title",children:t.userName}),Object(p.jsx)("button",{className:"profile__edit-button",type:"button",onClick:e.onEditProfile}),Object(p.jsx)("p",{className:"profile__subtitle",children:t.userDescription})]}),Object(p.jsx)("button",{className:"profile__add-button",type:"button",onClick:e.isAddPlacePopupOpen})]}),Object(p.jsx)("section",{className:"elements",children:Object(p.jsx)("ul",{className:"elements__list",children:n.map((function(t){return Object(p.jsx)(j,{card:t,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete},t._id)}))})})]})};var b=function(){return Object(p.jsx)("footer",{className:"footer",children:Object(p.jsx)("p",{className:"footer__copyright",children:"\xa9 Mesto Russia"})})};var _=function(e){return Object(p.jsx)("div",{className:e.isOpen?"popup popup_opened popup_type_".concat(e.name):"popup popup_type_".concat(e.name),children:Object(p.jsxs)("div",{className:"popup__image-container container",children:[Object(p.jsx)("button",{className:"popup__close-button popup__close-button_type_image",type:"button",onClick:e.closeAllPopups}),Object(p.jsx)("img",{className:"popup__image",src:e.card.link,alt:e.card.name}),Object(p.jsx)("p",{className:"popup__title popup__title_type_image",children:e.card.name})]})})};var f=function(e){return Object(p.jsx)("div",{className:e.isOpen?"popup popup_type_".concat(e.name," popup_opened "):"popup popup_type_".concat(e.name),children:Object(p.jsxs)("form",{className:"popup__container container",name:e.name,onSubmit:e.onSubmit,children:[Object(p.jsx)("h3",{className:"popup__title",children:e.title}),e.children,Object(p.jsx)("button",{className:"popup__save-button",type:"submit",children:e.buttonName}),Object(p.jsx)("button",{className:"popup__close-button",type:"button",onClick:e.closeAllPopups})]})})},O=n(20),x=n(21),g=new(function(){function e(t){Object(O.a)(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(x.a)(e,[{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{method:"GET",headers:this._headers}).then(this._checkStatusOK)}},{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:this._headers}).then(this._checkStatusOK)}},{key:"updateUserInfo",value:function(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkStatusOK)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkStatusOK)}},{key:"setAvatar",value:function(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkStatusOK)}},{key:"likeCard",value:function(e,t){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkStatusOK)}},{key:"createNewCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:n})}).then(this._checkStatusOK)}},{key:"_checkStatusOK",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430 ".concat(e.status))}}]),e}())({baseUrl:"".concat("https://mesto-back.herokuapp.com"),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("jwt"))}});var v=function(e){var t=c.a.useContext(h),n=c.a.useState(t.userName),a=Object(u.a)(n,2),s=a[0],o=a[1],r=c.a.useState(t.userDescription),i=Object(u.a)(r,2),l=i[0],d=i[1];return c.a.useEffect((function(){o(t.userName),d(t.userDescription)}),[t,e.isOpen]),Object(p.jsxs)(f,{name:"user-data",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",buttonName:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,closeAllPopups:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:s,about:l})},children:[Object(p.jsx)("input",{id:"name-input",className:"popup__text popup__text_type_name",type:"text",name:"name",minLength:"2",maxLength:"40",required:!0,placeholder:"\u0418\u043c\u044f",value:s||"",onChange:function(e){o(e.target.value)}}),Object(p.jsx)("span",{className:"popup__error name-input-error",id:"name-input-error"}),Object(p.jsx)("input",{id:"profession-input",className:"popup__text popup__text_type_profession",type:"text",name:"profession",minLength:"2",maxLength:"200",required:!0,placeholder:"\u041f\u0440\u043e\u0444\u0435\u0441\u0441\u0438\u044f",value:l||"",onChange:function(e){d(e.target.value)}}),Object(p.jsx)("span",{className:"popup__error profession-input-error",id:"profession-input-error"})]})};var N=function(e){var t=Object(a.useRef)();return Object(p.jsxs)(f,{name:"update-avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",buttonName:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,closeAllPopups:e.onClose,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t.current.value})},children:[Object(p.jsx)("input",{id:"avatar-input",type:"url",name:"link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",className:"popup__text popup__text_type_source",required:!0,ref:t}),Object(p.jsx)("span",{className:"popup__error avatar-input-error popup__error_avatar"})]})};var k=function(e){var t=Object(a.useRef)(),n=Object(a.useRef)();return Object(p.jsxs)(f,{name:"place-data",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",buttonName:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,closeAllPopups:e.onClose,onSubmit:function(a){a.preventDefault(),e.onAddPlace({link:n.current.value,name:t.current.value}),t.current.value="",n.current.value=""},children:[Object(p.jsx)("input",{id:"place-input",className:"popup__text popup__text_type_place",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",type:"text",name:"name",minLength:"2",maxLength:"30",required:!0,ref:t}),Object(p.jsx)("span",{id:"place-input-error",className:"popup__error place-input-error"}),Object(p.jsx)("input",{id:"url-input",type:"url",name:"link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",className:"popup__text popup__text_type_source",required:!0,ref:n}),Object(p.jsx)("span",{className:"popup__error url-input-error"})]})},y="https://mesto-back.herokuapp.com",C=function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))},S=n(13),I=n(10),E=["component"],A=function(e){var t=e.component,n=Object(I.a)(e,E);return Object(p.jsx)(l.b,Object(S.a)(Object(S.a)({},n),{},{render:function(e){return!0===n.loggedIn?Object(p.jsx)(t,Object(S.a)(Object(S.a)({},e),n)):Object(p.jsx)(l.a,{to:"./sign-in"})}}))},L=["onReg"],P=function(e){var t=e.onReg,n=Object(I.a)(e,L),s=c.a.useState(""),o=Object(u.a)(s,2),r=o[0],i=o[1],d=c.a.useState(""),h=Object(u.a)(d,2),j=h[0],m=h[1],b=Object(l.g)();return Object(a.useEffect)((function(){localStorage.getItem("jwt")&&b.push("/main")}),[b]),Object(p.jsxs)("form",{className:"auth",onSubmit:function(e){e.preventDefault(),t({passwordInput:j,emailInput:r}).then((function(){b.push("/sign-in"),n.setResStatus(!0)})).catch((function(e){n.setResStatus(!1),console.log(e)})).finally((function(){n.onInfoTool(!0)}))},children:[Object(p.jsx)("h2",{className:"auth__title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(p.jsx)("input",{className:"auth__input",type:"email",placeholder:"Email",minLength:"2",maxLength:"40",required:!0,value:r,onChange:function(e){i(e.target.value)}}),Object(p.jsx)("input",{className:"auth__input",type:"text",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",minLength:"8",maxLength:"40",required:!0,value:j,onChange:function(e){m(e.target.value)}}),Object(p.jsx)("button",{className:"auth__confirm-button",type:"submit",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),n.children]})},w=["onLog"],U=function(e){var t=e.onLog,n=Object(I.a)(e,w),s=c.a.useState(""),o=Object(u.a)(s,2),r=o[0],i=o[1],d=c.a.useState(""),h=Object(u.a)(d,2),j=h[0],m=h[1],b=Object(l.g)();Object(a.useEffect)((function(){return function(){localStorage.getItem("jwt")&&b.push("/main")}}),[b]);var _=function(){i(""),m("")};return Object(p.jsxs)("form",{className:"auth",onSubmit:function(e){e.preventDefault(),t({passwordInput:j,emailInput:r}).then(_).then((function(){b.push("/main")})).catch((function(e){console.log(e)}))},children:[Object(p.jsx)("h2",{className:"auth__title",children:"\u0412\u0445\u043e\u0434"}),Object(p.jsx)("input",{className:"auth__input",type:"email",placeholder:"Email",required:!0,value:r,onChange:function(e){i(e.target.value)},minLength:"2",maxLength:"40"}),Object(p.jsx)("input",{className:"auth__input",type:"text",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",minLength:"2",maxLength:"40",required:!0,value:j,onChange:function(e){m(e.target.value)}}),Object(p.jsx)("button",{className:"auth__confirm-button",type:"submit",children:"\u0412\u043e\u0439\u0442\u0438"}),n.children]})},T=n.p+"static/media/RegisterOk.1b6082f8.svg",D=n.p+"static/media/RegisterError.df8eddf6.svg";var R=function(e){return Object(p.jsx)("div",{className:e.isOpen?"popup popup_opened popup_type_success":"popup popup_type_success",children:Object(p.jsxs)("div",{className:"popup__container",name:e.name,children:[Object(p.jsx)("img",{className:"popup__icon",src:e.resStatus?T:D,alt:"approved"}),Object(p.jsx)("h2",{className:"popup__title",style:{textAlign:"center",fontSize:"20px",paddingBottom:"0"},children:e.resStatus?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."}),Object(p.jsx)("button",{className:"popup__close-button",type:"reset",onClick:e.closeAllPopups})]})})};var q=function(e){var t=c.a.useState(!1),n=Object(u.a)(t,2),s=n[0],o=n[1],j=c.a.useState(!1),O=Object(u.a)(j,2),x=O[0],S=O[1],I=c.a.useState(!1),E=Object(u.a)(I,2),L=E[0],w=E[1],T=c.a.useState(!1),D=Object(u.a)(T,2),q=D[0],K=D[1],J=c.a.useState({}),B=Object(u.a)(J,2),z=B[0],F=B[1],G=c.a.useState(!1),H=Object(u.a)(G,2),M=H[0],Q=H[1],V=Object(l.g)(),W=Object(a.useState)(""),X=Object(u.a)(W,2),Y=X[0],Z=X[1],$=c.a.useState(!1),ee=Object(u.a)($,2),te=ee[0],ne=ee[1],ae=c.a.useState({}),ce=Object(u.a)(ae,2),se=ce[0],oe=ce[1],re=c.a.useState([]),ie=Object(u.a)(re,2),ue=ie[0],le=ie[1],pe=c.a.useState(!1),de=Object(u.a)(pe,2),he=de[0],je=de[1],me=function(e){return(t=e,fetch("".concat(y,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then(C)).then((function(e){e&&(Q(!0),Z(e.email))})).catch((function(e){console.log(e)}));var t};Object(a.useEffect)((function(){var e=localStorage.getItem("jwt");e&&me(e)}),[M]),Object(a.useEffect)((function(){M&&V.push("/main")}),[M,V]);var be=function(){localStorage.removeItem("jwt"),Q(!1),V.push("/sign-in")};function _e(){w(!1),S(!1),o(!1),K(!1),ne(!1)}c.a.useEffect((function(){Promise.all([g.getUserInfo(),g.getInitialCards()]).then((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1];console.log(n.name,n.avatar),oe({userName:n.name,userDescription:n.about,userAvatar:n.avatar,userId:n._id}),le(a)})).catch((function(e){console.log(e)}))}),[V]),c.a.useEffect((function(){var e=function(e){"Escape"===e.key&&_e()};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]);var fe=Object(l.h)();return Object(p.jsx)("div",{className:"page",children:Object(p.jsxs)(h.Provider,{value:se,children:[Object(p.jsx)(d,{children:function(){switch(fe.pathname){case"/main":return Object(p.jsxs)("div",{className:"header__auth",children:[Object(p.jsx)("p",{className:"header__email",style:{paddingRight:"24px"},children:Y}),Object(p.jsx)(r.b,{className:" auth__link",to:"/sign-up",onClick:be,children:"\u0412\u044b\u0439\u0442\u0438"})]});case"/sign-in":return Object(p.jsx)("div",{className:"header__auth",children:Object(p.jsx)(r.b,{className:" auth__link",to:"/sign-up",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})});case"/sign-up":return Object(p.jsx)("div",{className:"header__auth",children:Object(p.jsx)(r.b,{className:" auth__link",to:"/sign-in",children:"\u0412\u043e\u0439\u0442\u0438"})})}}()}),Object(p.jsxs)(l.d,{children:[Object(p.jsx)(A,{path:"/main",loggedIn:M,component:m,cards:ue,onEditProfile:function(){o(!0)},isAddPlacePopupOpen:function(){S(!0)},onEditAvatar:function(){w(!0)},onCardClick:function(e){F(e),K(!0)},card:z,onCardLike:function(e){var t=e.likes.some((function(e){return e===se.userId}));g.likeCard(e._id,t).then((function(t){le((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch((function(e){console.log(e)}))},onCardDelete:function(e){g.deleteCard(e._id).then((function(){le((function(t){return t.filter((function(t){return t._id!==e._id}))}))})).catch((function(e){console.log(e)}))},onSignOut:be}),Object(p.jsx)(l.b,{path:"/sign-up",children:Object(p.jsx)(P,{onReg:function(e){return function(e,t){return fetch("".concat(y,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then(C)}(e.passwordInput,e.emailInput).then((function(e){if(e&&400!==e.statusCode)return e;throw new Error("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a")}))},onInfoTool:ne,setResStatus:je,children:Object(p.jsxs)("p",{className:"auth__span",children:["\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?",Object(p.jsx)(r.b,{className:"auth__span auth__link",to:"/sign-in",children:"  \u0412\u043e\u0439\u0442\u0438"})]})})}),Object(p.jsx)(l.b,{path:"/sign-in",children:Object(p.jsx)(U,{loggedIn:M,setLoggedIn:Q,onLog:function(e){return function(e,t){return fetch("".concat(y,"/signin"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("jwt"))},body:JSON.stringify({password:e,email:t})}).then(C)}(e.passwordInput,e.emailInput).then((function(e){if(!e||!e.token)throw new Error("\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c");e.token&&(Q(!0),localStorage.setItem("jwt",e.token))})).catch((function(e){console.log(e)}))}})}),Object(p.jsx)(l.b,{children:M?Object(p.jsx)(l.a,{to:"/main"}):Object(p.jsx)(l.a,{to:"/sign-in"})})]}),Object(p.jsx)(_,{card:z,isOpen:q,closeAllPopups:_e}),Object(p.jsx)(v,{isOpen:s,onClose:_e,onUpdateUser:function(e){g.updateUserInfo(e).then((function(e){oe({userName:e.data.name,userDescription:e.data.about,userAvatar:e.data.avatar,userId:e.data._id}),_e()})).catch((function(e){console.log(e)}))}}),Object(p.jsx)(N,{isOpen:L,onClose:_e,onUpdateAvatar:function(e){g.setAvatar(e.avatar).then((function(e){oe({userName:e.data.name,userDescription:e.data.about,userAvatar:e.data.avatar,userId:e.data._id}),_e()})).catch((function(e){console.log(e)}))}}),Object(p.jsx)(k,{isOpen:x,onClose:_e,onAddPlace:function(e){g.createNewCard(e).then((function(e){le([e].concat(Object(i.a)(ue))),_e()})).catch((function(e){console.log(e)}))}}),Object(p.jsx)(f,{name:"approval",title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",buttonName:"\u0414\u0430",isOpen:!1}),Object(p.jsx)(R,{isOpen:te,closeAllPopups:_e,resStatus:he}),Object(p.jsx)(b,{})]})})},K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),s(e),o(e)}))};o.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(r.a,{children:Object(p.jsx)(q,{})})}),document.getElementById("root")),K()}},[[36,1,2]]]);
//# sourceMappingURL=main.7c3a8f0f.chunk.js.map